---
title: 'SGD CPTEx data'
author: "Alex"
date: "2024-07-18"
output: html_document
---


```{r}
library(here)
library(sgdGMF)
library(dplyr)
library(RSpectra)
library(scater)
library(BiocParallel)
library(BiocSingular)
library(DelayedArray)

devtools::load_all(here("omicsGMF"))

```


```{r}
family <- gaussian()
fixed_feature <- 5000
fixed_sample <- 1000
fixed_dim <- 10
```


# Feature benchmarks

```{r}

for(feature_size in c(100, 1000, 10000, 100000)){
  if(!file.exists(here("Analyses","Computational_time_benchmark","Output",
                                            paste0("sgd_analysis_", feature_size, 
                      "_features_", fixed_sample, "_samples.RDS"))
                 )){
  set.seed(100)
  values <- readRDS(
          file = here(paste0("Data/Computational_time_benchmark/simulated_", feature_size, 
                      "_features_", fixed_sample, "_samples.RDS")))
  begin_time <- Sys.time()
  analysis <- calculateGMF(values, family = family, 
                             control.alg = list(tol = 0.001, maxiter = 10000),
                             ncomponents = fixed_dim)
  end_time <- Sys.time()
  time_diff <- end_time - begin_time
    saveRDS(object = time_diff, 
            file = here("Analyses","Computational_time_benchmark","Output",
                                            paste0("sgd_time_", feature_size, 
                      "_features_", fixed_sample, "_samples.RDS")))
    saveRDS(object = analysis, 
            file = here("Analyses","Computational_time_benchmark","Output",
                                            paste0("sgd_analysis_", feature_size, 
                      "_features_", fixed_sample, "_samples.RDS")))
    rm(analysis)
    gc()
  }

}
```

